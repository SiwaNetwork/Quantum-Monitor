# QUANTUM-PCI Configuration and Monitoring Tools

Комплект инструментов для конфигурации и мониторинга платы QUANTUM-PCI с улучшенным GUI интерфейсом и поддержкой sys/class структуры Linux.

## Описание

Данный проект представляет собой полный набор инструментов для работы с платой QUANTUM-PCI:

1. **GUI Конфигуратор** - улучшенный графический интерфейс для настройки устройства
2. **Считыватель статусов** - консольная утилита для чтения и мониторинга статуса
3. **Веб-монитор** - веб-интерфейс для удаленного мониторинга в реальном времени

## Файлы проекта

### Основные компоненты

- `quantum_pci_configurator.py` - GUI конфигуратор с поддержкой всех функций устройства
- `quantum_pci_status_reader.py` - консольная утилита для чтения статусов
- `quantum_pci_web_monitor.py` - веб-сервер для удаленного мониторинга
- `templates/index.html` - веб-интерфейс для мониторинга
- `quantum_pci_tools.sh` - скрипт управления всеми инструментами

### Исходные файлы

- `configurator.py` - оригинальный конфигуратор (базовая версия)
- `timecard-config.sh` - оригинальный shell-скрипт конфигурации
- `readme.md` - оригинальная документация
- Патчи и драйверы для ядра Linux

## Возможности

### GUI Конфигуратор

- **Обнаружение устройства** - автоматический поиск QUANTUM-PCI в системе
- **Информация об устройстве** - отображение серийного номера, пути устройства
- **Настройка источников синхронизации** - выбор и установка clock source
- **Конфигурация SMA портов** - настройка входов и выходов SMA1-SMA4
- **Управление генераторами сигналов** - настройка параметров GEN1-GEN4
- **Мониторинг GNSS** - отображение статуса синхронизации GNSS
- **Настройка временных меток** - конфигурация timestampers TS1-TS4
- **Мониторинг в реальном времени** - автоматическое обновление статуса
- **Сохранение/загрузка конфигурации** - работа с файлами настроек

### Считыватель статусов

- **Множественные форматы вывода** - JSON, человекочитаемый, компактный
- **Селективное чтение** - отдельные компоненты (clock, GNSS, SMA, etc.)
- **Мониторинг в реальном времени** - с настраиваемым интервалом
- **Сохранение в файл** - логирование статуса
- **Автоматическое обнаружение устройства** - поиск в /sys/class/timecard/

### Веб-монитор

- **Современный веб-интерфейс** - адаптивный дизайн
- **REST API** - программный доступ к данным
- **Автоматическое обновление** - real-time мониторинг
- **Визуальные индикаторы** - статус синхронизации, работы генераторов
- **Удаленный доступ** - мониторинг через браузер

## Системные требования

- Linux с поддержкой sys/class/timecard
- Python 3.6+
- Драйвер ptp_ocp
- Права доступа к /sys/class/timecard/

### Зависимости Python

- tkinter (для GUI)
- flask, flask-cors (для веб-интерфейса)
- pathlib, subprocess, threading (стандартные модули)

## Установка и использование

### Быстрый старт

```bash
# Проверка системы и зависимостей
./quantum_pci_tools.sh check

# Установка зависимостей
./quantum_pci_tools.sh install

# Запуск GUI конфигуратора
./quantum_pci_tools.sh gui

# Просмотр статуса
./quantum_pci_tools.sh status

# Мониторинг в реальном времени
./quantum_pci_tools.sh monitor

# Веб-интерфейс
./quantum_pci_tools.sh web
```

### Детальное использование

#### GUI Конфигуратор

```bash
python3 quantum_pci_configurator.py
```

Запускает графический интерфейс с вкладками:
- Device Info - информация об устройстве
- Clock Sources - настройка источников синхронизации
- SMA Configuration - конфигурация SMA портов
- Signal Generators - управление генераторами
- GNSS Status - статус GNSS приемника
- Timestampers - настройка временных меток
- Status Monitor - мониторинг в реальном времени

#### Считыватель статусов

```bash
# Базовая информация
python3 quantum_pci_status_reader.py --basic

# Статус синхронизации
python3 quantum_pci_status_reader.py --clock

# Полный статус в JSON
python3 quantum_pci_status_reader.py --format json

# Мониторинг с интервалом 2 секунды
python3 quantum_pci_status_reader.py --monitor --interval 2

# Сохранение в файл
python3 quantum_pci_status_reader.py --output status.json --format json
```

#### Веб-монитор

```bash
python3 quantum_pci_web_monitor.py
```

Запускает веб-сервер на порту 5000. Доступ через браузер:
- http://localhost:5000 - основной интерфейс
- http://localhost:5000/api/status - API для получения статуса

## Структура sys/class/timecard

Инструменты работают с Linux sys/class интерфейсом:

```
/sys/class/timecard/ocpN/
├── serialnum                 # Серийный номер
├── clock_source              # Текущий источник синхронизации
├── available_clock_sources   # Доступные источники
├── gnss_sync                 # Статус GNSS синхронизации
├── clock_status_drift        # Дрейф часов
├── clock_status_offset       # Смещение часов
├── available_sma_inputs      # Доступные SMA входы
├── available_sma_outputs     # Доступные SMA выходы
├── sma1, sma2, sma3, sma4    # Конфигурация SMA портов
├── gen1/, gen2/, gen3/, gen4/ # Генераторы сигналов
│   ├── signal                # Управление генератором
│   ├── period                # Период сигнала
│   ├── duty                  # Скважность
│   ├── phase                 # Фаза
│   ├── polarity              # Полярность
│   └── running               # Статус работы
├── freq1/, freq2/, freq3/, freq4/ # Частотные счетчики
│   ├── frequency             # Измеренная частота
│   └── seconds               # Период измерения
├── ptp -> /dev/ptpN          # Ссылка на PTP устройство
└── pps -> /dev/ppsN          # Ссылка на PPS устройство
```

## Особенности реализации

### Безопасность

- Проверка прав доступа к файлам устройства
- Обработка ошибок чтения/записи
- Валидация входных данных
- Timeout для команд

### Производительность

- Кэширование статуса устройства
- Асинхронное обновление в GUI
- Оптимизированные запросы к sys/class
- Минимальная нагрузка на систему

### Совместимость

- Поддержка различных версий драйвера ptp_ocp
- Автоматическое обнаружение доступных функций
- Graceful degradation при отсутствии устройства
- Кроссплатформенность (Linux)

## Отличия от оригинального конфигуратора

### Улучшения GUI

1. **Современный интерфейс** - использование ttk виджетов
2. **Вкладочная структура** - логическое разделение функций
3. **Реальное время** - автоматическое обновление статуса
4. **Расширенная функциональность** - поддержка всех возможностей устройства
5. **Обработка ошибок** - информативные сообщения об ошибках

### Новые возможности

1. **Веб-интерфейс** - удаленный мониторинг
2. **API доступ** - программный интерфейс
3. **Множественные форматы** - JSON, текст, компактный вывод
4. **Логирование** - сохранение истории статуса
5. **Конфигурационные файлы** - сохранение/загрузка настроек

### Архитектурные улучшения

1. **Модульность** - разделение на независимые компоненты
2. **Расширяемость** - легкое добавление новых функций
3. **Тестируемость** - изолированные функции
4. **Документированность** - подробные комментарии и документация

## Устранение неполадок

### Устройство не обнаружено

1. Проверьте установку устройства: `lspci | grep -i quantum`
2. Загрузите драйвер: `sudo modprobe ptp_ocp`
3. Проверьте права доступа: `ls -la /sys/class/timecard/`
4. Проверьте dmesg на ошибки загрузки драйвера

### GUI не запускается

1. Установите tkinter: `sudo apt-get install python3-tk`
2. Проверьте DISPLAY переменную для X11
3. Используйте консольные инструменты как альтернативу

### Веб-интерфейс недоступен

1. Установите Flask: `pip3 install flask flask-cors`
2. Проверьте порт 5000: `netstat -tlnp | grep 5000`
3. Проверьте firewall настройки

## Лицензия

Проект основан на оригинальных файлах QUANTUM-PCI и расширяет их функциональность.
Используйте в соответствии с лицензией оригинального проекта.

## Поддержка

Для получения поддержки:
1. Проверьте документацию sys/class/timecard
2. Изучите логи системы (dmesg, syslog)
3. Используйте встроенную диагностику: `./quantum_pci_tools.sh check`

